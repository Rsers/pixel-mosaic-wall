# 任务：更新 AI 规则 - 添加 Vercel/部署相关任务的强制检查

## 背景
当前规则中没有明确说明"部署相关"、"环境适配"等任务也属于 complex，导致 AI 助手直接用 `search_replace` 修改代码，而不是使用 DeepSeek Reasoner。

## 问题案例
```
用户：为什么不能让用户上传文件？
AI：直接用 search_replace 修改代码，添加 Vercel 环境判断、路径映射等
实际应该：评估为 complex → 创建任务规范 → 调用 DeepSeek Reasoner
```

## 需要添加的内容

### 1. 在"复杂度评估"章节添加"部署和环境适配"特征

在 `## 🔍 强制复杂度评估` 表格中的 **complex** 行，添加：
- **部署适配**
- **环境差异处理**
- **路径映射**
- **平台限制**

### 2. 添加"部署/环境适配任务专项规则"章节

**标题：** `## 🌍 部署/环境适配任务专项规则（新增）`

**内容要点：**
```
### 🚨 触发词
看到以下关键词时，必须评估为 complex：
- "Vercel"/"Netlify"/"Serverless"
- "环境适配"/"平台适配"
- "文件上传"/"文件存储"
- "路径映射"/"静态文件服务"
- "无服务器"/"Lambda"
- "/tmp 目录"/"只读文件系统"

### 强制流程
1. 停下来！不要直接修改代码
2. 评估复杂度：complex（涉及平台限制、环境差异）
3. 告知用户：
   ✅ 复杂度评估：complex
   ✅ 原因：涉及 [Vercel/环境适配/文件系统限制]
   ✅ 选择模型：deepseek-reasoner
   ✅ 预计成本：¥0.05
4. 创建任务规范：tasks/task-00X-vercel-xxx.txt
5. 调用 DeepSeek Reasoner
6. 审核和部署

### 典型场景
1. Vercel 文件上传 → complex（文件系统只读，需要 /tmp）
2. 静态文件路径 → complex（url_for vs 硬编码）
3. 数据库路径 → complex（/tmp vs 本地路径）
4. 环境变量判断 → complex（if VERCEL 逻辑）
```

### 3. 更新"违规自检"清单

在现有违规自检中添加：
```
- ❌ 我看到"Vercel"/"部署"/"环境"等词，但直接修改代码 → 严重违规！
- ❌ 我在处理文件路径/上传/存储问题时，没有先评估 → 严重违规！
```

### 4. 更新"常见场景应对"表格

添加新行：
```
| "Vercel 上传问题" | 1. **停！评估复杂度**<br>2. complex：平台限制<br>3. 创建任务规范<br>4. DeepSeek Reasoner | ❌ 直接修改路径代码 |
| "环境适配" | 同上 | ❌ 直接添加 if 判断 |
```

## 输出要求

生成更新后的完整 `rule1.md` 文件，包含：
1. 所有现有内容保持不变
2. 在合适位置插入上述新内容
3. 保持 Markdown 格式一致
4. 章节编号连贯

## 关键原则

**记忆口诀：**
```
看到部署和环境词，
立即停止别动手。
Complex任务用Reasoner，
平台适配要深究。
```

## 验证

更新后的规则应该能防止以下情况：
- ❌ 看到"Vercel 文件上传"就直接改代码
- ❌ 看到"路径问题"就直接 search_replace
- ✅ 先评估 → 创建任务 → 调用 Reasoner → 审核部署

